# ๐ ุงูุชูุซูู ุงูููุฏุณู ุงููุนูุงุฑู ููุดุฑูุน MKT_KSA_Geolocation_Security

---    ๐ ููุตุฉ ุชุญููู ุงูุฃูุงู ุงูุฌุบุฑุงูู MKT KSA โ ุชุทููุฑ ููุตูุฑ ุจู ุฎุงูุฏ
* ๐ ุฑุฎุตุฉ Apache 2.0 โ ูุณูุญ ุจุงูุงุณุชุฎุฏุงู ูุงูุชุนุฏูู ุจุดุฑุท ุงููุณุจุฉ ูุนุฏู ุชูุฏูู ุถูุงูุงุช.
* MKT KSA Geolocation Security โ Developed by Mansour Bin Khalid (KSA ๐ธ๐ฆ)
* Licensed under Apache 2.0 โ https://www.apache.org/licenses/LICENSE-2.0
* ยฉ 2025 All rights reserved.

## 1. ูุตู ุงููุดุฑูุน ูุฏูุฑู ุงูุนุงู

**MKT_KSA_Geolocation_Security** ูู ูุธุงู ูุชูุงูู ูุชุญููู ูุชูุซูู ูุชูููู ุงูุซูุฉ ูู ุงูุจูุงูุงุช ุงูุฌุบุฑุงููุฉ ูุงูุณููููุฉ ููุฃุฌูุฒุฉ ูุงููุณุชุฎุฏูููุ ูุน ุฏุนู ูุชูุฏู ููุฃูุงูุ ุงูุชูุงูู ูุน ุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ุงูุจููู ุชุดููุ ูุฎูุงุฑุฒููุงุช ููุงููุฉ ูููุฌูุงุช ุงููููููุฉ. ููุฏู ุงููุดุฑูุน ุฅูู ุชูููุฑ ููุตุฉ ุขููุฉ ูุฐููุฉ ููุชุญูู ูู ุงููููุนุ ุงูุจุตูุฉ ุงูุฑูููุฉุ ุงูุณูููุ ุงูุดุจูุฉุ ูุงูุญุณุงุณุงุชุ ูุน ุฅููุงููุฉ ุงูุชูุงูู ูุน ุฎุฏูุงุช ุฎุงุฑุฌูุฉ (ุทูุณุ ุฎุฑุงุฆุทุ ุฅูุฎ) ุนุจุฑ API ูWebhook.

---

## 2. ุงููุนูุงุฑูุฉ ุงูุนุงูุฉ (Architecture Overview)

- **ุทุจูุฉ API:**  ูุงุฌูุงุช RESTful ููุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ (ุชูุจููุงุชุ ุชุญููู ุณูููุ ุชุญููู ุฌูุงุฒุ ุดุจูุฉุ ุญุณุงุณุงุชุ ุทูุณ...).
- **ุทุจูุฉ Core:**  ูุญุฑูุงุช ุงูุชุญููู ุงูุฐููุฉ (GeoResolver, DeviceFP, Behavior, Sensors, Network, CrossValidation)ุ ูู ูููุง ูุตูู ููููู ูุงุจููุง ููุญูู ูุงูุชูุณุนุฉ.
- **ุทุจูุฉ Security:**  ุฅุฏุงุฑุฉ ุงูุชูุซูู (JWT)ุ ุงูุณูุงุณุงุชุ ุงูุชุญูู ูู ุงููุฏุฎูุงุชุ ุชุญุฏูุฏ ุงููุนุฏูุ ุฅูุฎ.
- **ุทุจูุฉ DB:**  ููุงุฐุฌ ูุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช (CRUD) ูุน ุฏุนู ุฃูุงู ูุชูุฏู.
- **ุทุจูุฉ Utils:**  ุฃุฏูุงุช ูุณุงุนุฏุฉ (ุชุฎุฒูู ูุคูุชุ ุฏูุงู ุนุงูุฉุ ุชุณุฌูู).
- **ูููุงุช ุงูุชููุฆุฉ:**  ุฌููุน ุงูููู ุงูุญุณุงุณุฉ ูุงูุซูุงุจุช ุชูุฏุงุฑ ูู ุฎูุงู ููู ุชููุฆุฉ ุฎุงุฑุฌู (.env).

---

## 3. ุชูุตูู ุงููููุงุช ูุงููุฌูุฏุงุช (ููููุง ููููุง)

### A. ูุฌูุฏ src/api/

| ุงูููู                | ุงูุฏูุฑ                                                                 | ุงูููู/ุงูุซูุงุจุช/ุงูุฏูุงู ุงููุงูุฉ                |
|----------------------|-----------------------------------------------------------------------|--------------------------------------------|
| alerts.rs            | ุฅุฏุงุฑุฉ ุชูุจููุงุช ุงูุฃูุงู ุนุจุฑ API (ุฅุทูุงู ุชูุจููุ ุงูุชุญูู ูู JWT)             | JWT_SECRET_KEYุ JWT_ISSUERุ JWT_AUDIENCE   |
| auth.rs              | ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (ุฌูุจ ุจูุงูุงุช ูุณุชุฎุฏูุ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช)             | ูุนุชูุฏ ุนูู UserService                      |
| behavior.rs          | ุชุญููู ุงูุณููู ุนุจุฑ API (ุชูุฑูุฑ ุงูุจูุงูุงุช ููุญุฑู BehaviorEngine)            | JWT_*ุ ุฏูุงู ุชุญููู ุงูุณููู                   |
| dashboard.rs         | ุนุฑุถ ููุฎุต ุงููุธุงู (ุฅุญุตุงุฆูุงุช) ุนุจุฑ API                                    | JWT_*                                      |
| device.rs            | ุชุญููู ุจุตูุฉ ุงูุฌูุงุฒ ุนุจุฑ API (ุชูุฑูุฑ ุงูุจูุงูุงุช ููุญุฑู DeviceFP)             | JWT_*ุ ุฏูุงู ุชุญููู ุงูุจุตูุฉ                   |
| geo.rs               | ุงูุชุญูู ุงูุฌุบุฑุงูู ุนุจุฑ API (ุชูุฑูุฑ ุงูุจูุงูุงุช ููุญุฑู CrossValidation)        | JWT_*ุ ุฏูุงู ุงูุชุญูู ุงูุฌุบุฑุงูู                |
| network.rs           | ุชุญููู ุงูุดุจูุฉ ุนุจุฑ API (ุชูุฑูุฑ ุงูุจูุงูุงุช ููุญุฑู NetworkAnalyzer)           | JWT_*ุ ุฏูุงู ุชุญููู ุงูุดุจูุฉ                   |
| sensors.rs           | ุชุญููู ุจูุงูุงุช ุงูุญุณุงุณุงุช ุนุจุฑ API (ุชูุฑูุฑ ุงูุจูุงูุงุช ููุญุฑู SensorsAnalyzer)  | JWT_*ุ ุฏูุงู ุชุญููู ุงูุญุณุงุณุงุช                 |
| weather.rs           | ุฌูุจ ุจูุงูุงุช ุงูุทูุณ ุนุจุฑ API (ููุทู ุงุฎุชุจุงุฑู ุฃู ุชูุงูู ุฎุงุฑุฌู)                | JWT_*ุ WEATHER_WEBHOOK_URL (ุฅู ูุฌุฏุช)       |
| mod.rs               | ุชุฌููุน ูุญุฏุงุช ุงูู API                                                   | -                                          |

### B. ูุฌูุฏ src/core/

| ุงูููู                  | ุงูุฏูุฑ                                                                 | ุงูููู/ุงูุซูุงุจุช/ุงูุฏูุงู ุงููุงูุฉ                        |
|------------------------|-----------------------------------------------------------------------|----------------------------------------------------|
| geo_resolver.rs        | ูุญุฑู ุชุญููู ูุชูููุน ุงููููุน ุงูุฌุบุฑุงูู ุงูุฐูู                                | LOCATION_SECRET_KEYุ MAX_ACCURACY_THRESHOLDุ ุฅูุฎ    |
| device_fp.rs           | ูุญุฑู ุงูุจุตูุฉ ุงูุฑูููุฉ ููุฃุฌูุฒุฉุ ูุน ุฏุนู ุงูุชุดููุฑ ุงูููู                      | ุฏูุงู ุชูููุฏ ุงูููุงุชูุญุ secure_key (ููููุฏ runtime)    |
| behavior_bio.rs        | ูุญุฑู ุชุญููู ุงูุณููู ูุงูุจูููุชุฑูู                                         | ุฏูุงู ุชุญููู ุงูุณูููุ ููุงุฐุฌ ุณููููุฉ                    |
| cross_location.rs      | ูุญุฑู ุงูุชุญูู ุงููุชูุงุทุน (CrossValidation)                                | FINAL_VERDICT_SIGNING_KEYุ GEOIP_DB_PATH           |
| sensors_analyzer.rs    | ูุญุฑู ุชุญููู ุจูุงูุงุช ุงูุญุณุงุณุงุช                                            | ุฏูุงู ุชุญููู ุงูุญุณุงุณุงุชุ ุซูุงุจุช ุญุณุงุณุงุช                  |
| network_analyzer.rs    | ูุญุฑู ุชุญููู ุงูุดุจูุฉ (VPN/Proxy/Tor)                                     | ุฏูุงู ุชุญููู ุงูุดุจูุฉุ ุซูุงุจุช ุงูุดุจูุฉ                    |
| history.rs             | ุฅุฏุงุฑุฉ ูุชุฎุฒูู ูุชุญููู ุงูุฃุญุฏุงุซ ุงูุชุงุฑูุฎูุฉ                                 | ุฏูุงู ุฅุฏุงุฑุฉ ุงูุฃุญุฏุงุซ                                 |
| mod.rs                 | ุชุฌููุน ูุญุฏุงุช core                                                     | -                                                  |

### C. ูุฌูุฏ src/security/

| ุงูููู                  | ุงูุฏูุฑ                                                                 | ุงูููู/ุงูุซูุงุจุช/ุงูุฏูุงู ุงููุงูุฉ                        |
|------------------------|-----------------------------------------------------------------------|----------------------------------------------------|
| jwt.rs                 | ุฅุฏุงุฑุฉ ุงูุชูุซูู ุนุจุฑ JWT (ุชูููุฏุ ููุ ุชุญูู)                               | JWT_SECRET_KEYุ JWT_ISSUERุ JWT_AUDIENCE           |
| input_validator.rs     | ุงูุชุญูู ูุชุนููู ุงููุฏุฎูุงุช (XSS, Homoglyph, ุฅูุฎ)                          | ุฏูุงู sanitize/normalize/validate                   |
| policy.rs              | ูุญุฑู ุงูุณูุงุณุงุช ุงูุฐูู (RBAC/ABAC)                                       | ุฏูุงู can_executeุ PolicyContext                    |
| ratelimit.rs           | ุชุญุฏูุฏ ุงููุนุฏู (Rate Limiting)                                          | ุฅุนุฏุงุฏุงุช ุงูุญุงูู (governor)                          |
| mod.rs                 | ุชุฌููุน ูุญุฏุงุช ุงูุฃูุงู                                                    | -                                                  |

### D. ูุฌูุฏ src/db/

| ุงูููู                  | ุงูุฏูุฑ                                                                 | ุงูููู/ุงูุซูุงุจุช/ุงูุฏูุงู ุงููุงูุฉ                        |
|------------------------|-----------------------------------------------------------------------|----------------------------------------------------|
| crud.rs                | ุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (CRUD)                                  | ุฏูุงู get_user_by_idุ create_deviceุ ุฅูุฎ             |
| models.rs              | ููุงุฐุฌ ุงูุจูุงูุงุช (User, Device, LocationRecord, ...)                    | ุชุนุฑูู ุงูุญูููุ ุชูุซูู ูู ุญูู                          |
| mod.rs                 | ุชุฌููุน ูุญุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช                                            | -                                                  |

### E. ูุฌูุฏ src/utils/

| ุงูููู                  | ุงูุฏูุฑ                                                                 | ุงูููู/ุงูุซูุงุจุช/ุงูุฏูุงู ุงููุงูุฉ                        |
|------------------------|-----------------------------------------------------------------------|----------------------------------------------------|
| cache.rs               | ูุญุฌูุฒ ูุชูุณุนุฉ ููุทู ุงูุชุฎุฒูู ุงููุคูุช ูุณุชูุจูุงู                             | -                                                  |
| helpers.rs             | ุฏูุงู ูุณุงุนุฏุฉ ุนุงูุฉ (ุชุดููุฑุ ุญุณุงุจ ูุณุงูุฉุ ุฅูุฎ)                             | aes_encryptุ calculate_distance                     |
| logger.rs              | ูุญุฌูุฒ ูุชูุณุนุฉ ููุทู ุงูุชุณุฌูู ูุณุชูุจูุงู                                    | -                                                  |
| mod.rs                 | ุชุฌููุน ูุญุฏุงุช ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ                                          | -                                                  |

### F. ูููุงุช ุงูุฌุฐุฑ

| ุงูููู                  | ุงูุฏูุฑ                                                                 | ุงูููู/ุงูุซูุงุจุช/ุงูุฏูุงู ุงููุงูุฉ                        |
|------------------------|-----------------------------------------------------------------------|----------------------------------------------------|
| main.rs                | ููุทุฉ ุงูุฏุฎูู ุงูุฑุฆูุณูุฉุ ุชููุฆุฉ ุงูุฎุงุฏูุ ุชุญููู ุงูุฅุนุฏุงุฏุงุชุ ุชุณุฌูู ุงููุณุงุฑุงุช    | AppStateุ ุชููุฆุฉ ุงููุญุฑูุงุช                            |
| config.rs              | ูุญุฌูุฒ ูุชูุณุนุฉ ููุทู ุงูุฅุนุฏุงุฏุงุช (ููุฑุฃ ูู .env ุฃู ูุชุบูุฑุงุช ุงูุจูุฆุฉ)           | ุฌููุน ุงูููู ุงูุญุณุงุณุฉ ูุงูุซูุงุจุช                         |

---

## 4. ููู ุงูุชููุฆุฉ (env.example) - ุงูููู ูุงูุซูุงุจุช

ุงูุธุฑ ููู `env.example` ุงููุฑูู ูุน ุงููุดุฑูุนุ ููููุตุญ ุฏุงุฆููุง ุจุชุญุฏูุซู ุนูุฏ ุฅุถุงูุฉ ุฃู ูููุฉ ุฌุฏูุฏุฉ.

---

## 5. ููุงุญุธุงุช ููุฏุณูุฉ ูุฃูููุฉ

- **ูุง ุชูุฌุฏ ุฃู ุฃุณุฑุงุฑ ุฃู ููุงุชูุญ ุตุฑูุญุฉ ูู ุงูููุฏ**ุ ุฌููุนูุง ุชูุฏุงุฑ ูู ุฎูุงู ููู ุงูุชููุฆุฉ.
- **ูู ุฏุงูุฉ ุฃู ูุญุฏุฉ ูู core ููุซูุฉ** ุฅุฐุง ูุงูุช ูุฎุตุตุฉ ููุชูุงูู ุงูุฎุงุฑุฌู ุฃู ุงูุงุณุชุฏุนุงุก ุงููุณุชูุจูู.
- **ุงูุงุฎุชุจุงุฑุงุช ูุง ุชูุถููู ูู ุงูุฅูุชุงุฌ** ููุง ุชุคุซุฑ ุนูู ุงูุฃูุงู ุฃู ุงูุฃุฏุงุก.
- **ูููุงุช cache.rs ูlogger.rs ูุญุฌูุฒุฉ ููุชูุณุนุฉ**ุ ููููู ุชูุนูููุง ูุงุญููุง ุญุณุจ ุงูุญุงุฌุฉ.
- **ุฌููุน ุงูููู ุงูุญุณุงุณุฉ ูุฌุจ ุฃู ุชูุฏุงุฑ ูู ุฎูุงู .env ุฃู config ููุท**ุ ููุง ุชููุดุฑ ุฃุจุฏูุง ูู ุงููุณุชูุฏุน ุงูุนุงู.

---

## 6. ุชูุตูุงุช ูููุทูุฑูู ุงูุฌุฏุฏ

- ุฑุงุฌุน ููู ุงูุชููุฆุฉ (env.example) ููุนุฑูุฉ ุฌููุน ุงูููู ุงููุทููุจุฉ.
- ูุง ุชุถุน ุฃู ุณุฑ ุฃู ููุชุงุญ ุตุฑูุญ ูู ุงูููุฏ.
- ุงุณุชุฎุฏู ุงูุชูุซูู ูู ุฑุฃุณ ูู ููู ูููู ุฏูุฑู ูุงูููุทู ุงูุฏุงุฎูู.
- ุนูุฏ ุฅุถุงูุฉ ุชูุงูู ุฌุฏูุฏ (Webhook, API ุฎุงุฑุฌู)ุ ุฃุถู ุงูููู ุงููุทููุจุฉ ูู ููู ุงูุชููุฆุฉ ููุซูููุง ููุง. 